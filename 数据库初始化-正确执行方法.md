# 数据库初始化 - 正确执行方法

## ❌ 错误的执行方式
在腾讯云控制台的SQL查询窗口中，**不能**执行这样的命令：
```bash
mysql -h gz-cdb-j5cb8gq5.sql.tencentcdb.com -P 27393 -u root -p dakabiji < database_init.sql
```
这是命令行语法，不是SQL语句。

---

## ✅ 正确的执行方式

### 方式1：在腾讯云控制台SQL查询窗口中执行（推荐）

**步骤：**

1. **打开 `database_init.sql` 文件**
   - 在本地打开文件：`f:\AI编程\dakabij\database_init.sql`

2. **复制全部内容**
   - 按 `Ctrl+A` 全选
   - 按 `Ctrl+C` 复制

3. **粘贴到腾讯云控制台的SQL查询窗口**
   - 在SQL查询窗口中按 `Ctrl+V` 粘贴
   - 点击"执行"按钮

4. **查看执行结果**
   - 应该看到类似这样的输出：
     ```
     Query OK, 0 rows affected
     Query OK, 0 rows affected
     ...
     +----------------+
     | Tables_in_dakabiji |
     +----------------+
     | users           |
     | habits          |
     | check_in_records|
     | notes           |
     | note_categories |
     | habit_scenes    |
     | habit_scene_relations |
     | statistics      |
     +----------------+
     ```

---

### 方式2：使用本地命令行执行

如果您在本地安装了MySQL客户端，可以使用命令行：

**Windows系统：**
```bash
# 打开命令提示符（CMD）或PowerShell
cd f:\AI编程\dakabij
mysql -h gz-cdb-j5cb8gq5.sql.tencentcdb.com -P 27393 -u root -p dakabiji < database_init.sql
```

**Linux/Mac系统：**
```bash
cd /path/to/dakabij
mysql -h gz-cdb-j5cb8gq5.sql.tencentcdb.com -P 27393 -u root -p dakabiji < database_init.sql
```

执行后会提示输入密码：`qinghan741852963`

---

### 方式3：分步在SQL查询窗口中执行

如果一次性粘贴所有内容有问题，可以分步执行：

**步骤1：创建用户表**
```sql
CREATE TABLE IF NOT EXISTS users (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT '用户ID',
    openid VARCHAR(100) UNIQUE NOT NULL COMMENT '微信OpenID',
    nickname VARCHAR(50) COMMENT '用户昵称',
    avatar_url VARCHAR(255) COMMENT '头像URL',
    phone VARCHAR(20) COMMENT '手机号',
    email VARCHAR(100) COMMENT '邮箱',
    status TINYINT DEFAULT 1 COMMENT '状态：1-正常，0-禁用',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_openid (openid)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='用户表';
```

**步骤2：创建习惯表**
```sql
CREATE TABLE IF NOT EXISTS habits (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT '习惯ID',
    user_id INT NOT NULL COMMENT '用户ID',
    name VARCHAR(100) NOT NULL COMMENT '习惯名称',
    description VARCHAR(500) COMMENT '习惯描述',
    icon VARCHAR(50) COMMENT '图标',
    color VARCHAR(20) COMMENT '颜色',
    frequency_type ENUM('daily','weekly','monthly') DEFAULT 'daily' COMMENT '频率类型',
    target_count INT DEFAULT 1 COMMENT '目标次数',
    reminder_time TIME COMMENT '提醒时间',
    reminder_enabled TINYINT DEFAULT 0 COMMENT '是否开启提醒',
    start_date DATE COMMENT '开始日期',
    end_date DATE COMMENT '结束日期',
    status TINYINT DEFAULT 1 COMMENT '状态：1-进行中，0-已停用',
    sort_order INT DEFAULT 0 COMMENT '排序',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_user_id (user_id),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='习惯表';
```

**步骤3：创建打卡记录表**
```sql
CREATE TABLE IF NOT EXISTS check_in_records (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT '记录ID',
    habit_id INT NOT NULL COMMENT '习惯ID',
    user_id INT NOT NULL COMMENT '用户ID',
    check_in_date DATE NOT NULL COMMENT '打卡日期',
    check_in_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '打卡时间',
    note VARCHAR(500) COMMENT '备注',
    mood TINYINT COMMENT '心情：1-很差，2-差，3-一般，4-好，5-很好',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    FOREIGN KEY (habit_id) REFERENCES habits(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    UNIQUE KEY uk_habit_date (habit_id, check_in_date),
    INDEX idx_user_date (user_id, check_in_date),
    INDEX idx_check_in_date (check_in_date)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='打卡记录表';
```

**步骤4：创建笔记表**
```sql
CREATE TABLE IF NOT EXISTS notes (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT '笔记ID',
    user_id INT NOT NULL COMMENT '用户ID',
    title VARCHAR(200) NOT NULL COMMENT '笔记标题',
    content TEXT COMMENT '笔记内容',
    category_id INT COMMENT '分类ID',
    tags VARCHAR(500) COMMENT '标签（逗号分隔）',
    is_public TINYINT DEFAULT 0 COMMENT '是否公开：1-公开，0-私有',
    view_count INT DEFAULT 0 COMMENT '查看次数',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_user_id (user_id),
    INDEX idx_category_id (category_id),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='笔记表';
```

**步骤5：创建笔记分类表**
```sql
CREATE TABLE IF NOT EXISTS note_categories (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT '分类ID',
    user_id INT NOT NULL COMMENT '用户ID',
    name VARCHAR(50) NOT NULL COMMENT '分类名称',
    icon VARCHAR(50) COMMENT '图标',
    color VARCHAR(20) COMMENT '颜色',
    sort_order INT DEFAULT 0 COMMENT '排序',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_user_id (user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='笔记分类表';
```

**步骤6：创建习惯情境表**
```sql
CREATE TABLE IF NOT EXISTS habit_scenes (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT '情境ID',
    user_id INT NOT NULL COMMENT '用户ID',
    name VARCHAR(50) NOT NULL COMMENT '情境名称',
    description VARCHAR(200) COMMENT '情境描述',
    icon VARCHAR(50) COMMENT '图标',
    background_color VARCHAR(20) COMMENT '背景颜色',
    sort_order INT DEFAULT 0 COMMENT '排序',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_user_id (user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='习惯情境表';
```

**步骤7：创建习惯情境关联表**
```sql
CREATE TABLE IF NOT EXISTS habit_scene_relations (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT '关联ID',
    scene_id INT NOT NULL COMMENT '情境ID',
    habit_id INT NOT NULL COMMENT '习惯ID',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    FOREIGN KEY (scene_id) REFERENCES habit_scenes(id) ON DELETE CASCADE,
    FOREIGN KEY (habit_id) REFERENCES habits(id) ON DELETE CASCADE,
    UNIQUE KEY uk_scene_habit (scene_id, habit_id),
    INDEX idx_scene_id (scene_id),
    INDEX idx_habit_id (habit_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='习惯情境关联表';
```

**步骤8：创建统计数据表**
```sql
CREATE TABLE IF NOT EXISTS statistics (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT '统计ID',
    user_id INT NOT NULL COMMENT '用户ID',
    stat_date DATE NOT NULL COMMENT '统计日期',
    total_habits INT DEFAULT 0 COMMENT '总习惯数',
    active_habits INT DEFAULT 0 COMMENT '活跃习惯数',
    checked_in_count INT DEFAULT 0 COMMENT '打卡次数',
    total_notes INT DEFAULT 0 COMMENT '总笔记数',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    UNIQUE KEY uk_user_date (user_id, stat_date),
    INDEX idx_stat_date (stat_date)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='统计数据表';
```

**步骤9：插入默认数据**
```sql
INSERT INTO note_categories (user_id, name, icon, color, sort_order) VALUES
(0, '生活', 'life', '#FF6B6B', 1),
(0, '工作', 'work', '#4ECDC4', 2),
(0, '学习', 'study', '#45B7D1', 3),
(0, '健康', 'health', '#96CEB4', 4),
(0, '其他', 'other', '#FFEAA7', 5)
ON DUPLICATE KEY UPDATE name=VALUES(name);
```

**步骤10：验证表创建**
```sql
SHOW TABLES;
```

---

## 📝 执行后验证

执行完成后，运行以下SQL验证：

```sql
-- 查看所有表
SHOW TABLES;

-- 应该看到8个表
-- users
-- habits
-- check_in_records
-- notes
-- note_categories
-- habit_scenes
-- habit_scene_relations
-- statistics
```

---

## 💡 推荐操作

**最简单的方式：**
1. 打开文件 `f:\AI编程\dakabij\database_init.sql`
2. 全选复制（Ctrl+A, Ctrl+C）
3. 在腾讯云控制台SQL查询窗口粘贴（Ctrl+V）
4. 点击"执行"按钮

**执行完成后，请告诉我结果！**
