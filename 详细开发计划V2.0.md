# 习惯日记小程序 - 详细开发计划 V2.0

## 项目概述

本项目旨在将习惯日记小程序升级为支持内容创作者打卡管理的综合平台，重点实现打卡表功能模块和素材收集笔记记录功能。

### 核心目标
1. 实现完整的打卡表管理功能，支持每日任务打卡、数据记录、统计分析
2. 实现素材收集笔记功能，支持灵感素材、金句、关键词等收集管理
3. 实现数据统计分析和可视化展示

### 开发周期
- 总周期：6周
- 第一阶段（第1-2周）：基础架构搭建
- 第二阶段（第3-4周）：核心功能开发
- 第三阶段（第5-6周）：测试优化和上线

## 技术架构

### 后端技术栈
- Node.js + Express.js
- MySQL 5.7+
- JWT 身份认证
- PM2 进程管理
- Axios（HTTP客户端）
- Moment（日期处理）

### 前端技术栈
- 微信小程序原生框架
- JavaScript (ES6+)
- WeUI/Vant Weapp 组件库
- ECharts（数据可视化）

### 部署架构
- 腾讯云服务器
- Nginx 反向代理
- SSL/HTTPS

## 功能模块设计

### 模块一：打卡表管理模块

#### 1.1 任务管理
- 任务创建（支持设置名称、描述、分类、标签、目标值、时间段等）
- 任务编辑（更新任务信息）
- 任务删除（软删除）
- 任务列表（支持按分类、时间段、状态筛选）
- 任务排序（支持拖拽排序）

#### 1.2 打卡记录
- 每日打卡（支持勾选完成状态）
- 打卡备注（记录完成情况、心得体会）
- 满意度评分（1-5星评分）
- 耗时记录（记录完成任务耗时）
- 打卡历史（查看历史打卡记录）

#### 1.3 数据记录
- 量化数据记录（播放量、点赞数、评论数、收藏数、粉丝数等）
- 时间记录（生成时间、发布时间、完成时间等）
- 评分记录（满意度评分、技能水平评分）
- 备注记录（任务完成情况、优化建议、总结等）

#### 1.4 统计分析
- 日/周/月度统计（发布数量、播放量、粉丝增长、互动率等）
- 达成率计算（目标值vs实际值对比）
- 趋势分析（各周数据对比、最佳发布时间分析）
- 效率分析（平均制作时间、最高效平台、最受欢迎主题）
- 数据可视化（图表展示）

### 模块二：素材收集笔记模块

#### 2.1 素材分类管理
- 分类创建（支持设置名称、图标、颜色、排序）
- 分类编辑（更新分类信息）
- 分类删除（软删除）
- 分类列表（显示所有分类）

#### 2.2 素材收集
- 素材创建（支持设置标题、内容、分类、标签、来源、图片等）
- 素材编辑（更新素材信息）
- 素材删除（软删除）
- 素材列表（支持按分类、标签、时间筛选）
- 素材搜索（支持关键词搜索）

#### 2.3 素材类型
- 灵感素材（记录创作灵感）
- 金句收藏（收藏有意义的句子）
- 关键词库（收集创作关键词）
- 参考图片（保存参考图片）
- 技巧笔记（记录创作技巧）

#### 2.4 素材标签
- 标签创建（支持设置名称、颜色）
- 标签编辑（更新标签信息）
- 标签删除（软删除）
- 标签列表（显示所有标签）

### 模块三：数据统计模块

#### 3.1 基础统计
- 日统计（每日数据统计）
- 周统计（每周数据统计）
- 月统计（每月数据统计）
- 年统计（每年数据统计）

#### 3.2 高级分析
- 趋势分析（数据趋势图表）
- 对比分析（不同时间段对比）
- 效率分析（制作效率分析）
- 预测分析（数据趋势预测）

#### 3.3 数据可视化
- 图表展示（柱状图、折线图、饼图等）
- 数据导出（导出Excel、PDF等格式）
- 报告生成（自动生成统计报告）

## 数据库设计

### 核心表结构

#### 1. 任务分类表 (task_categories)
```sql
CREATE TABLE task_categories (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT NOT NULL,
    name VARCHAR(50) NOT NULL COMMENT '分类名称',
    icon VARCHAR(50) COMMENT '图标',
    color VARCHAR(20) COMMENT '颜色',
    sort_order INT DEFAULT 0 COMMENT '排序',
    status TINYINT DEFAULT 1 COMMENT '状态：1-启用，0-禁用',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_user_id (user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='任务分类表';
```

#### 2. 素材分类表 (material_categories)
```sql
CREATE TABLE material_categories (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT NOT NULL,
    name VARCHAR(50) NOT NULL COMMENT '分类名称',
    icon VARCHAR(50) COMMENT '图标',
    color VARCHAR(20) COMMENT '颜色',
    sort_order INT DEFAULT 0 COMMENT '排序',
    status TINYINT DEFAULT 1 COMMENT '状态：1-启用，0-禁用',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_user_id (user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='素材分类表';
```

#### 3. 素材表 (materials)
```sql
CREATE TABLE materials (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT NOT NULL,
    category_id INT COMMENT '分类ID',
    title VARCHAR(200) NOT NULL COMMENT '素材标题',
    content TEXT COMMENT '素材内容',
    material_type VARCHAR(50) DEFAULT 'inspiration' COMMENT '素材类型：inspiration-灵感，quote-金句，keyword-关键词，image-图片，tip-技巧',
    source VARCHAR(200) COMMENT '来源',
    image_url VARCHAR(500) COMMENT '图片URL',
    tags VARCHAR(500) COMMENT '标签（逗号分隔）',
    is_favorite TINYINT DEFAULT 0 COMMENT '是否收藏：1-收藏，0-未收藏',
    view_count INT DEFAULT 0 COMMENT '查看次数',
    status TINYINT DEFAULT 1 COMMENT '状态：1-正常，0-删除',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (category_id) REFERENCES material_categories(id) ON DELETE SET NULL,
    INDEX idx_user_id (user_id),
    INDEX idx_category_id (category_id),
    INDEX idx_material_type (material_type)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='素材表';
```

#### 4. 标签表 (tags)
```sql
CREATE TABLE tags (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT NOT NULL,
    name VARCHAR(50) NOT NULL COMMENT '标签名称',
    color VARCHAR(20) COMMENT '颜色',
    tag_type VARCHAR(50) DEFAULT 'material' COMMENT '标签类型：material-素材，task-任务，content-内容',
    usage_count INT DEFAULT 0 COMMENT '使用次数',
    status TINYINT DEFAULT 1 COMMENT '状态：1-正常，0-删除',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_user_id (user_id),
    INDEX idx_tag_type (tag_type)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='标签表';
```

### 扩展现有表结构

#### 扩展习惯表 (habits)
```sql
ALTER TABLE habits ADD COLUMN category_id INT COMMENT '任务分类ID';
ALTER TABLE habits ADD COLUMN target_value INT COMMENT '目标值';
ALTER TABLE habits ADD COLUMN actual_value INT COMMENT '实际值';
ALTER TABLE habits ADD COLUMN time_slot VARCHAR(50) COMMENT '时间段：morning-上午，afternoon-下午，evening-晚上等';
ALTER TABLE habits ADD COLUMN tags VARCHAR(500) COMMENT '标签（逗号分隔）';
ALTER TABLE habits ADD COLUMN priority TINYINT DEFAULT 2 COMMENT '优先级：1-高，2-中，3-低';
ALTER TABLE habits ADD COLUMN is_template TINYINT DEFAULT 0 COMMENT '是否模板：1-模板，0-非模板';
ALTER TABLE habits ADD COLUMN template_id INT COMMENT '模板ID';
```

#### 扩展打卡记录表 (check_in_records)
```sql
ALTER TABLE check_in_records ADD COLUMN completion_notes TEXT COMMENT '完成备注';
ALTER TABLE check_in_records ADD COLUMN satisfaction_score TINYINT COMMENT '满意度评分1-5';
ALTER TABLE check_in_records ADD COLUMN time_spent INT COMMENT '耗时（分钟）';
ALTER TABLE check_in_records ADD COLUMN completion_time DATETIME COMMENT '完成时间';
```

#### 扩展笔记表 (notes)
```sql
ALTER TABLE notes ADD COLUMN note_type VARCHAR(50) DEFAULT 'general' COMMENT '笔记类型：general-通用，material-素材，review-复盘等';
ALTER TABLE notes ADD COLUMN is_template TINYINT DEFAULT 0 COMMENT '是否模板：1-模板，0-非模板';
ALTER TABLE notes ADD COLUMN template_id INT COMMENT '模板ID';
```

## API接口设计

### 任务分类相关接口

#### 1. 获取任务分类列表
```
GET /api/task-categories
参数：
- openid: 用户openid（必填）
- status: 状态（可选，1-启用，0-禁用）

响应：
{
  "status": "success",
  "data": [
    {
      "id": 1,
      "name": "内容创作",
      "icon": "content",
      "color": "#FF6B6B",
      "sort_order": 1,
      "status": 1,
      "created_at": "2025-01-01 00:00:00"
    }
  ]
}
```

#### 2. 创建任务分类
```
POST /api/task-categories
参数：
- openid: 用户openid（必填）
- name: 分类名称（必填）
- icon: 图标（可选）
- color: 颜色（可选）
- sort_order: 排序（可选）

响应：
{
  "status": "success",
  "message": "任务分类创建成功",
  "data": { "id": 1 }
}
```

#### 3. 更新任务分类
```
PUT /api/task-categories/:id
参数：
- openid: 用户openid（必填）
- name: 分类名称（可选）
- icon: 图标（可选）
- color: 颜色（可选）
- sort_order: 排序（可选）
- status: 状态（可选）

响应：
{
  "status": "success",
  "message": "任务分类更新成功"
}
```

#### 4. 删除任务分类
```
DELETE /api/task-categories/:id
参数：
- openid: 用户openid（必填）

响应：
{
  "status": "success",
  "message": "任务分类删除成功"
}
```

### 素材收集相关接口

#### 1. 获取素材分类列表
```
GET /api/material-categories
参数：
- openid: 用户openid（必填）
- status: 状态（可选，1-启用，0-禁用）

响应：
{
  "status": "success",
  "data": [
    {
      "id": 1,
      "name": "灵感素材",
      "icon": "lightbulb",
      "color": "#FFD93D",
      "sort_order": 1,
      "status": 1,
      "created_at": "2025-01-01 00:00:00"
    }
  ]
}
```

#### 2. 创建素材分类
```
POST /api/material-categories
参数：
- openid: 用户openid（必填）
- name: 分类名称（必填）
- icon: 图标（可选）
- color: 颜色（可选）
- sort_order: 排序（可选）

响应：
{
  "status": "success",
  "message": "素材分类创建成功",
  "data": { "id": 1 }
}
```

#### 3. 获取素材列表
```
GET /api/materials
参数：
- openid: 用户openid（必填）
- category_id: 分类ID（可选）
- material_type: 素材类型（可选：inspiration、quote、keyword、image、tip）
- tags: 标签（可选）
- keyword: 搜索关键词（可选）
- is_favorite: 是否收藏（可选：1-收藏，0-未收藏）
- page: 页码（可选，默认1）
- page_size: 每页数量（可选，默认20）

响应：
{
  "status": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "category_id": 1,
        "title": "治愈森林灵感",
        "content": "吉卜力风格的治愈系森林场景",
        "material_type": "inspiration",
        "source": "小红书",
        "image_url": "https://example.com/image.jpg",
        "tags": "治愈,森林,吉卜力",
        "is_favorite": 1,
        "view_count": 10,
        "created_at": "2025-01-01 00:00:00"
      }
    ],
    "total": 100,
    "page": 1,
    "page_size": 20
  }
}
```

#### 4. 创建素材
```
POST /api/materials
参数：
- openid: 用户openid（必填）
- category_id: 分类ID（可选）
- title: 素材标题（必填）
- content: 素材内容（可选）
- material_type: 素材类型（可选，默认inspiration）
- source: 来源（可选）
- image_url: 图片URL（可选）
- tags: 标签（可选，逗号分隔）

响应：
{
  "status": "success",
  "message": "素材创建成功",
  "data": { "id": 1 }
}
```

#### 5. 更新素材
```
PUT /api/materials/:id
参数：
- openid: 用户openid（必填）
- category_id: 分类ID（可选）
- title: 素材标题（可选）
- content: 素材内容（可选）
- material_type: 素材类型（可选）
- source: 来源（可选）
- image_url: 图片URL（可选）
- tags: 标签（可选，逗号分隔）
- is_favorite: 是否收藏（可选）

响应：
{
  "status": "success",
  "message": "素材更新成功"
}
```

#### 6. 删除素材
```
DELETE /api/materials/:id
参数：
- openid: 用户openid（必填）

响应：
{
  "status": "success",
  "message": "素材删除成功"
}
```

#### 7. 收藏/取消收藏素材
```
POST /api/materials/:id/favorite
参数：
- openid: 用户openid（必填）
- is_favorite: 是否收藏（必填：1-收藏，0-取消收藏）

响应：
{
  "status": "success",
  "message": "操作成功"
}
```

### 扩展统计相关接口

#### 1. 获取达成率统计
```
GET /api/statistics/achievement-rate
参数：
- openid: 用户openid（必填）
- start_date: 开始日期（可选）
- end_date: 结束日期（可选）

响应：
{
  "status": "success",
  "data": {
    "total_habits": 10,
    "completed_habits": 8,
    "achievement_rate": 80,
    "habits": [
      {
        "habit_id": 1,
        "habit_name": "每日生成壁纸",
        "target_value": 30,
        "actual_value": 30,
        "achievement_rate": 100
      },
      {
        "habit_id": 2,
        "habit_name": "每日发布视频",
        "target_value": 30,
        "actual_value": 25,
        "achievement_rate": 83.33
      }
    ]
  }
}
```

#### 2. 获取效率分析
```
GET /api/statistics/efficiency
参数：
- openid: 用户openid（必填）
- start_date: 开始日期（可选）
- end_date: 结束日期（可选）

响应：
{
  "status": "success",
  "data": {
    "average_time_spent": 45,
    "most_efficient_time_slot": "afternoon",
    "most_efficient_platform": "xiaohongshu",
    "most_popular_theme": "治愈系",
    "habits": [
      {
        "habit_id": 1,
        "habit_name": "每日生成壁纸",
        "average_time_spent": 30,
        "efficiency_score": 90
      },
      {
        "habit_id": 2,
        "habit_name": "每日发布视频",
        "average_time_spent": 60,
        "efficiency_score": 75
      }
    ]
  }
}
```

#### 3. 获取趋势分析
```
GET /api/statistics/trend
参数：
- openid: 用户openid（必填）
- start_date: 开始日期（必填）
- end_date: 结束日期（必填）
- metric: 指标（必填：view、like、comment、collect、fan等）

响应：
{
  "status": "success",
  "data": {
    "metric": "view",
    "trend": [
      {
        "date": "2025-01-01",
        "value": 1000
      },
      {
        "date": "2025-01-02",
        "value": 1200
      },
      {
        "date": "2025-01-03",
        "value": 1100
      }
    ],
    "average": 1100,
    "max": 1200,
    "min": 1000,
    "growth_rate": 10
  }
}
```

#### 4. 获取对比分析
```
GET /api/statistics/compare
参数：
- openid: 用户openid（必填）
- compare_type: 对比类型（必填：week-周对比，month-月对比，platform-平台对比）
- start_date: 开始日期（必填）
- end_date: 结束日期（必填）
- compare_start_date: 对比开始日期（可选）
- compare_end_date: 对比结束日期（可选）

响应：
{
  "status": "success",
  "data": {
    "compare_type": "week",
    "current_period": {
      "start_date": "2025-01-01",
      "end_date": "2025-01-07",
      "total_view": 10000,
      "total_like": 1000,
      "total_comment": 200,
      "total_collect": 500
    },
    "previous_period": {
      "start_date": "2024-12-25",
      "end_date": "2024-12-31",
      "total_view": 8000,
      "total_like": 800,
      "total_comment": 150,
      "total_collect": 400
    },
    "growth": {
      "view": 25,
      "like": 25,
      "comment": 33.33,
      "collect": 25
    }
  }
}
```

## 开发计划

### 第一阶段：基础架构搭建（第1-2周）

#### 第1周：数据库设计和基础API开发
- **任务1.1**：设计并创建新数据库表（2天）
  - 创建任务分类表 (task_categories)
  - 创建素材分类表 (material_categories)
  - 创建素材表 (materials)
  - 创建标签表 (tags)

- **任务1.2**：扩展现有数据库表（1天）
  - 扩展习惯表 (habits)
  - 扩展打卡记录表 (check_in_records)
  - 扩展笔记表 (notes)

- **任务1.3**：开发任务分类相关API（1天）
  - GET /api/task-categories
  - POST /api/task-categories
  - PUT /api/task-categories/:id
  - DELETE /api/task-categories/:id

- **任务1.4**：开发素材分类相关API（1天）
  - GET /api/material-categories
  - POST /api/material-categories
  - PUT /api/material-categories/:id
  - DELETE /api/material-categories/:id

- **任务1.5**：开发素材相关API（2天）
  - GET /api/materials
  - POST /api/materials
  - PUT /api/materials/:id
  - DELETE /api/materials/:id
  - POST /api/materials/:id/favorite

#### 第2周：统计功能API开发
- **任务2.1**：开发达成率统计API（1天）
  - GET /api/statistics/achievement-rate

- **任务2.2**：开发效率分析API（1天）
  - GET /api/statistics/efficiency

- **任务2.3**：开发趋势分析API（1天）
  - GET /api/statistics/trend

- **任务2.4**：开发对比分析API（1天）
  - GET /api/statistics/compare

- **任务2.5**：开发数据可视化API（1天）
  - GET /api/statistics/chart
  - GET /api/statistics/export

- **任务2.6**：API测试和文档编写（1天）
  - 测试所有新增API接口
  - 编写API文档

### 第二阶段：核心功能开发（第3-4周）

#### 第3周：素材收集笔记功能开发
- **任务3.1**：开发素材分类管理页面（2天）
  - 素材分类列表页面
  - 素材分类添加页面
  - 素材分类编辑页面
  - 支持拖拽排序

- **任务3.2**：开发素材收集页面（3天）
  - 素材列表页面（支持筛选、搜索）
  - 素材添加页面
  - 素材详情页面
  - 素材编辑页面
  - 支持收藏功能

- **任务3.3**：开发标签管理页面（1天）
  - 标签列表页面
  - 标签添加页面
  - 标签编辑页面

- **任务3.4**：开发素材统计页面（1天）
  - 素材数量统计
  - 素材类型分布
  - 素材使用频率统计

#### 第4周：打卡表功能开发
- **任务4.1**：开发任务分类管理页面（1天）
  - 任务分类列表页面
  - 任务分类添加页面
  - 任务分类编辑页面
  - 支持拖拽排序

- **任务4.2**：扩展习惯列表页面（2天）
  - 增加分类筛选功能
  - 增加时间段筛选功能
  - 增加标签筛选功能
  - 显示目标值和实际值
  - 显示达成率

- **任务4.3**：扩展打卡记录页面（1天）
  - 增加完成备注功能
  - 增加满意度评分功能
  - 增加耗时记录功能

- **任务4.4**：开发达成率统计页面（1天）
  - 达成率计算
  - 达成率图表展示
  - 达成率趋势分析

### 第三阶段：测试优化和上线（第5-6周）

#### 第5周：测试和Bug修复
- **任务7.1**：功能测试（2天）
  - 测试所有新增功能
  - 测试API接口
  - 测试前端页面

- **任务7.2**：性能测试（1天）
  - 测试数据库查询性能
  - 测试API响应时间
  - 测试页面加载速度

- **任务7.3**：Bug修复（2天）
  - 修复发现的Bug
  - 优化代码逻辑
  - 优化用户体验

#### 第8周：优化和上线
- **任务8.1**：代码优化（1天）
  - 代码重构
  - 代码注释
  - 代码规范检查

- **任务8.2**：文档编写（1天）
  - API文档更新
  - 用户手册编写
  - 开发文档更新

- **任务8.3**：部署上线（2天）
  - 服务器环境配置
  - 数据库迁移
  - 代码部署
  - 上线测试

- **任务8.4**：上线后监控（1天）
  - 监控系统运行状态
  - 监控用户反馈
  - 快速响应问题

## 风险管理

### 技术风险
- **风险1**：数据库性能问题
  - 影响：系统响应慢
  - 应对：优化数据库查询，添加索引，使用缓存

- **风险2**：API接口兼容性问题
  - 影响：前后端对接困难
  - 应对：统一接口规范，做好接口文档

### 进度风险
- **风险3**：开发周期延长
  - 影响：无法按时上线
  - 应对：分阶段实施，优先实现核心功能

- **风险4**：需求变更
  - 影响：需要重新开发
  - 应对：充分调研需求，做好需求管理

### 质量风险
- **风险5**：Bug较多
  - 影响：用户体验差
  - 应对：加强测试，及时修复Bug

- **风险6**：数据安全问题
  - 影响：用户数据泄露
  - 应对：加强数据加密，做好权限管理

## 成功标准

### 功能标准
- 所有核心功能正常运行
- API接口响应时间 < 500ms
- 页面加载时间 < 2s
- 系统稳定性 > 99%

### 性能标准
- 支持1000+并发用户
- 数据库查询优化
- 缓存命中率 > 80%

### 用户体验标准
- 用户满意度 > 85%
- 用户留存率 > 70%
- 用户投诉率 < 5%

## 总结

本开发计划详细规划了习惯日记小程序的升级开发，重点关注打卡表功能模块和素材收集笔记记录功能。通过分阶段实施，优先实现核心功能，逐步完善高级功能，预计在8周内完成所有开发任务并上线。

项目具有良好的技术基础和扩展性，开发风险可控，成功标准明确，是一个值得投入的项目。
