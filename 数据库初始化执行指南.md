# 数据库初始化执行指南

## 一、连接到数据库

### 方式1：使用命令行连接
```bash
mysql -h gz-cdb-j5cb8gq5.sql.tencentcdb.com -P 27393 -u root -p
```

输入密码：`qinghan741852963`

### 方式2：使用MySQL客户端工具
- Navicat
- MySQL Workbench
- DBeaver
- phpMyAdmin

连接信息：
- 主机：`gz-cdb-j5cb8gq5.sql.tencentcdb.com`
- 端口：`27393`
- 用户名：`root`
- 密码：`qinghan741852963`
- 数据库：`dakabiji`

---

## 二、执行初始化脚本

### 方式1：命令行执行
```bash
# 在本地执行（需要将database_init.sql上传到服务器或本地有mysql客户端）
mysql -h gz-cdb-j5cb8gq5.sql.tencentcdb.com -P 27393 -u root -p dakabiji < database_init.sql
```

### 方式2：在MySQL命令行中执行
```sql
-- 1. 连接到数据库
mysql -h gz-cdb-j5cb8gq5.sql.tencentcdb.com -P 27393 -u root -p

-- 2. 选择数据库
USE dakabiji;

-- 3. 执行脚本（复制database_init.sql文件内容并粘贴）
-- 或者使用source命令
SOURCE /path/to/database_init.sql;
```

### 方式3：使用腾讯云控制台
1. 登录腾讯云控制台
2. 进入云数据库MySQL控制台
3. 找到您的数据库实例
4. 点击"登录"进入数据库管理页面
5. 打开SQL查询窗口
6. 复制`database_init.sql`文件内容
7. 粘贴并执行

---

## 三、验证数据库初始化

### 查看所有表
```sql
SHOW TABLES;
```

应该看到以下8个表：
- users
- habits
- check_in_records
- notes
- note_categories
- habit_scenes
- habit_scene_relations
- statistics

### 查看表结构
```sql
-- 查看用户表结构
DESC users;

-- 查看习惯表结构
DESC habits;

-- 查看笔记表结构
DESC notes;
```

### 验证初始数据
```sql
-- 查看默认笔记分类
SELECT * FROM note_categories;
```

---

## 四、测试数据库连接（可选）

### 使用Node.js测试
创建测试文件 `test-db.js`：

```javascript
const mysql = require('mysql2/promise');

async function testConnection() {
    try {
        const connection = await mysql.createConnection({
            host: 'gz-cdb-j5cb8gq5.sql.tencentcdb.com',
            port: 27393,
            user: 'root',
            password: 'qinghan741852963',
            database: 'dakabiji'
        });

        console.log('✅ 数据库连接成功！');

        // 查询所有表
        const [tables] = await connection.execute('SHOW TABLES');
        console.log('📊 数据库表列表：');
        tables.forEach(table => {
            console.log(`  - ${Object.values(table)[0]}`);
        });

        await connection.end();
        console.log('✅ 测试完成！');
    } catch (error) {
        console.error('❌ 数据库连接失败：', error.message);
    }
}

testConnection();
```

运行测试：
```bash
npm install mysql2
node test-db.js
```

---

## 五、常见问题

### 问题1：连接超时
**解决方案**：
- 检查网络连接
- 确认腾讯云数据库白名单设置
- 检查防火墙规则

### 问题2：权限不足
**解决方案**：
```sql
-- 授予root用户所有权限
GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' WITH GRANT OPTION;
FLUSH PRIVILEGES;
```

### 问题3：数据库不存在
**解决方案**：
```sql
-- 创建数据库
CREATE DATABASE IF NOT EXISTS dakabiji CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 问题4：表已存在
**解决方案**：
脚本中已使用 `CREATE TABLE IF NOT EXISTS`，会自动跳过已存在的表。

---

## 六、安全建议

### 1. 创建专用数据库用户（推荐）
```sql
-- 创建专用用户
CREATE USER 'dakabiji_user'@'%' IDENTIFIED BY 'your_secure_password';

-- 授予权限
GRANT ALL PRIVILEGES ON dakabiji.* TO 'dakabiji_user'@'%';

-- 刷新权限
FLUSH PRIVILEGES;
```

### 2. 配置数据库白名单
在腾讯云控制台中，配置数据库访问白名单，只允许您的服务器IP访问。

### 3. 定期备份数据库
```bash
# 备份数据库
mysqldump -h gz-cdb-j5cb8gq5.sql.tencentcdb.com -P 27393 -u root -p dakabiji > backup_$(date +%Y%m%d).sql
```

---

## 七、完成检查清单

- [ ] 已成功连接到数据库
- [ ] 已执行初始化脚本
- [ ] 8个数据表已创建
- [ ] 默认笔记分类已插入
- [ ] 数据库连接测试通过
- [ ] 已配置数据库白名单（可选）
- [ ] 已创建专用数据库用户（可选）

---

**执行完成后，请告诉我结果，我将进行下一步操作！**
